<div class="code-editor container">
    <!-- Navbar to select language options -->
    <nav class="navbar navbar-toggleable-md navbar-light bg-faded">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
        <a class="navbar-brand">{{lang}}</a>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Languages</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" (click)="changeLanguage('ruby')">Ruby</a>
                        <a class="dropdown-item" (click)="changeLanguage('javascript')">JavaScript</a>
                        <a class="dropdown-item" (click)="changeLanguage('python')">Python</a>
                    </div>
                </li>
            </ul>
            <div class="btn-group">
                <button class="btn btn-info" (click)="updateStatus()" type="button">Save</button>
                <button [routerLink]="['../../graphs', id]" class="btn btn-primary" type="button">Backtest</button>
                <button routerLink="/dashboard/investor" class="btn btn-success" type="button" data-toggle="modal" data-target="#runModal">Run Live!</button>
            </div>

            <!-- Modal -->
            <div id="runModal" class="modal fade" role="dialog">
                <div class="modal-dialog">

                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">Currently running algorithms:</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-success">
                                <strong>Queued!</strong> {{title}} will start running live soon - check your projects dashboard in a few moments
                            </div>
                            <table class="table borderless">
                                <tbody>
                                    <tr>
                                        <th>Algorithm</th>
                                    </tr>
                                    <tr>
                                        <td>You have no running algorithms.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-success"><i class="fa fa-plus" aria-hidden="true"></i> Run another algorithm</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal" routerLink="/dashboard/developer">Go to your projects dashboard</button>
                            <button type="button" class="btn btn-warning" data-dismiss="modal">Close</button>
                        </div>
                    </div>

                </div>
>>>>>>> a8a35fb3844dad6fb423d440b8967ef46d3fed45
            </div>
        </div>
    </nav>
    <!-- The ace editor -->
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <button type="button" class="btn btn-default" routerLink="/dashboard/developer"><i class="fa fa-arrow-left" aria-hidden="true"></i> Back to your projects dashboard</button>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8">
                <div class="form-group" *ngIf="!isSaved">
                    <label>Enter name:</label>
                    <input type="text" [(ngModel)]="title" class="form-control">
                </div>
                <div class="form-group" *ngIf="!isSaved">
                    <button class="btn btn-default" (click)="isSaved=true">Save new name</button>
                </div>
                <h4 *ngIf="isSaved" (click)="isSaved=false">{{title}}</h4>
                <ace-editor id="editor" class="ace" [(text)]="text" #editor></ace-editor>
            </div>
            <div class="col-lg-4">
                <h3>Python API Reference</h3>
                <div class="panel-group" id="accordion">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
            Currency Prices</a>
          </h4>
                        </div>
                        <div id="collapse1" class="panel-collapse collapse in">
                            <div class="panel-body">
                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>

                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>

                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>

                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
            Economic Indicator Data</a>
          </h4>
                        </div>
                        <div id="collapse2" class="panel-collapse collapse">
                            <div class="panel-body">
                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>

                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>

                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>

                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>

                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
            The Current State</a>
          </h4>
                        </div>
                        <div id="collapse3" class="panel-collapse collapse">
                            <div class="panel-body">
                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>

                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse4">
            Buying and Selling</a>
          </h4>
                        </div>
                        <div id="collapse4" class="panel-collapse collapse">
                            <div class="panel-body">
                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>

                                <p>
                                    <strong><code>get_price(target_curr, base_curr, time)</code></strong>
                                </p>
                                <p>
                                    Returns the exchange rate of <code>target_curr</code> in <code>base_curr</code> and <code>time</code>.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Buttons that allow saving and running the tests -->
</div>
<form>
    <textarea id="yourcode">
    </textarea><!-- from abc import ABC, abstractmethod
    from datetime import datetime, timedelta
    import http.client

    API_BASE_URL = 'justforex.xyz:3020'
    step = timedelta(seconds=3600)  # hour step
    conn = http.client.HTTPConnection(API_BASE_URL)


    def format_datetime_string(dt):
        return dt.isoformat()


    def get_price(target_curr, base_curr, time):
        prices = {
            'GBP': 50.0,
            'EUR': 37.0,
            'JPY': 1.0,
            'USD': 31.0,
            'CHF': 0.5,
            }
        return prices[target_curr] / prices[base_curr]
        '''
        http://justforex.xyz:3020/userapi-backend/currency_price?target_curr=EUR&base_curr=GBP&time=2012-04-05T21:04:09
        http_request_str = '/userapi-backend/currency_price?'
        http_request_str += 'target_curr=' + target_curr
        http_request_str += '&base_curr=' + base_curr
        http_request_str += '&time=' + format_datetime_string(time)
        conn.request('GET', http_request_str)
        resp = conn.getresponse()
        data = resp.read()
        return data
        '''


    def get_prices_in_period(
        target_curr,
        base_curr,
        now,
        period_length,
        ):
        start_of_period = now - period_length
        prices = []
        dt = start_of_period
        while dt - start_of_period < period_length:
            prices.append(get_price(target_curr, base_curr, dt))
            dt += step
        return prices


    def get_economic_indicator(indicatorType, indicator, time):
        http_request_str = '/userapi-backend/economicIndicator/' \
            + indicatorType + '?'
        http_request_str += 'indicator=' + indicator
        http_request_str += '&time=' + format_datetime_string(time)
        conn.request('GET', http_request_str)
        resp = conn.getresponse()
        data = resp.read()
        return data


    def get_economic_indicators_in_period(
        indicatorType,
        indicator,
        now,
        period_length,
        ):
        start_of_period = now - period_length
        values = []
        dt = start_of_period
        while dt - start_of_period < period_length:
            values.append(get_economic_indicator(indicatorType, indicator,
                          dt))
            dt += step
        return values

    class Algorithm(ABC):

        def __init__(self, start_datetime, end_datetime):
            self.start_datetime = start_datetime
            self.end_datetime = end_datetime
            self.current_time = self.start_datetime

        # Wallet of different currencies - all start off at 1000 US Dollars

            self.wallet = {
                'USD': 1000.0,
                'GBP': 0,
                'EUR': 0,
                'CHF': 0,
                'JPY': 0,
                }

        # List of transactions - (is_buy, target_curr, base_curr, volume, time, wallet state after)

            self.successful_transactions = []

        # List of transactions - (is_buy, target_curr, base_curr, volume, time, deficit in base_curr)

            self.unsuccessful_transactions = []

        # List of values of the wallet over time in USD - time-float pairs

            self.wallet_value_usd_list = []

        def parse_wallet_values_to_json(self):
            s = '?(\n'
            s+= '['
            for [time, value] in self.wallet_value_usd_list:
                s += '[' + str(time.timestamp()) + ',' + str(value) + '],\n'
            s = s[:-1]
            s += '\n]);'
            print(s)
            return s

        def wallet_state(self):
            return list(self.wallet.values())

        def record_wallet_value_usd(self):
            value_usd = 0
            for pair in self.wallet:
                value_usd += get_price(pair, 'USD', self.current_time) * self.wallet[pair]
            self.wallet_value_usd_list.append([self.current_time, value_usd])

        def get_price_period_high(
            self,
            target_curr,
            base_curr,
            period_length,
            ):
            return max(get_prices_in_period(target_curr, base_curr,
                       self.current_time, period_length))

        def get_price_period_low(
            self,
            target_curr,
            base_curr,
            period_length,
            ):
            return min(get_prices_in_period(target_curr, base_curr,
                       self.current_time, period_length))

        @abstractmethod
        def act(self):
            pass

        def run(self):
            while self.current_time < self.end_datetime:
                self.act()
                self.current_time += step
            conn.close()
            f = open('wallet_value_over_time.json','w')
            f.write(self.parse_wallet_values_to_json())
            f.close()

        def get_time(self):
            return self.current_time

        def get_inventory(self):
            return self.wallet


      # buy target_curr_volume worth of target_curr using base_curr
        def buy(
            self,
            target_curr,
            base_curr,
            target_curr_volume,
            ):
            exchange_rate = get_price(target_curr, base_curr,
                                      self.current_time)
            price_in_base_curr = target_curr_volume * exchange_rate
            if price_in_base_curr > self.wallet[base_curr]:
                deficit = price_in_base_curr - self.wallet[base_curr]
                self.unsuccessful_transactions.append([
                    True,
                    target_curr,
                    base_curr,
                    target_curr_volume,
                    self.current_time,
                    deficit,
                    ])
                return
            self.wallet[base_curr] -= price_in_base_curr
            self.wallet[target_curr] += target_curr_volume
            self.successful_transactions.append([
                True,
                target_curr,
                base_curr,
                target_curr_volume,
                self.current_time,
                self.wallet_state(),
                ])
            self.record_wallet_value_usd()


      # sell base_curr_volume worth of base_curr for target_curr
        def sell(
            self,
            base_curr,
            target_curr,
            base_curr_volume,
            ):
            if base_curr_volume > self.wallet[base_curr]:
                deficit = base_curr_volume - self.wallet[base_curr]
                self.unsuccessful_transactions.append([
                    False,
                    target_curr,
                    base_curr,
                    base_curr_volume,
                    self.current_time,
                    deficit,
                    ])
                return
            exchange_rate = get_price(base_curr, target_curr,
                                      self.current_time)
            amount_in_target_curr = base_curr_volume * exchange_rate
            self.wallet[base_curr] -= base_curr_volume
            self.wallet[target_curr] += amount_in_target_curr
            self.successful_transactions.append([
                False,
                target_curr,
                base_curr,
                base_curr_volume,
                self.current_time,
                self.wallet_state(),
                ])
            self.record_wallet_value_usd() --><br />
    <button class="btn btn-default" type="button" onclick="aceToText()">Run</button>
</form>
<pre id="output"></pre>
<!-- If you want turtle graphics include a canvas -->
<div id="mycanvas"></div>
